<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Demand Response with a storage component(simple battery) â€¢ EMPC</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Demand Response with a storage component(simple battery)">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EMPC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Building-Climate-Control.html">Building Climate Control with time-variant Constraints</a>
    </li>
    <li>
      <a href="../articles/Demand-Response-Simple-Battery.html">Demand Response with a storage component(simple battery)</a>
    </li>
    <li>
      <a href="../articles/Energy-Hub-Storage-Generation.html">Energyhub with storageand production component</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jywang2016/EMPC">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Demand Response with a storage component(simple battery)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jywang2016/EMPC/blob/master/vignettes/Demand-Response-Simple-Battery.Rmd"><code>vignettes/Demand-Response-Simple-Battery.Rmd</code></a></small>
      <div class="hidden name"><code>Demand-Response-Simple-Battery.Rmd</code></div>

    </div>

    
    
<div id="load-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#load-packages" class="anchor"></a>load packages</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(<span class="dt">list =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ls">ls</a></span>())
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(EMPC)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ECOSolveR)</code></pre></div>
</div>
<div id="load-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-data" class="anchor"></a>load data</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">'extdata/ssM.Rdata'</span>,<span class="dt">package =</span> <span class="st">'EMPC'</span>))
<span class="co"># state-space model of building</span>
ssmodel &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">A =</span> ssM<span class="op">$</span>A <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(),
                <span class="dt">Bu =</span> ssM<span class="op">$</span>Bu <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(),
                <span class="dt">Bd =</span> ssM<span class="op">$</span>Bd <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(),
                <span class="dt">C =</span> ssM<span class="op">$</span>C <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>())</code></pre></div>
</div>
<div id="build-mpc-object-and-set-value" class="section level2">
<h2 class="hasAnchor">
<a href="#build-mpc-object-and-set-value" class="anchor"></a>build MPC object and set value</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mpc3 &lt;-<span class="st"> </span>ehubmpc<span class="op">$</span><span class="kw">new</span>()
mpc3<span class="op">$</span><span class="kw">initialize</span>() <span class="co">#initialize building</span>

mpc3<span class="op">$</span>building<span class="op">$</span><span class="kw">setvalue</span>(<span class="dt">ssmodel =</span> ssmodel,
                       <span class="dt">disturbance =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(ssM<span class="op">$</span>Disturbance),
                       <span class="dt">timestep =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(ssM<span class="op">$</span>timestep),
                       <span class="dt">x0 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(ssM<span class="op">$</span>x0),
                       <span class="dt">continuous =</span> F)

mpc3<span class="op">$</span>building<span class="op">$</span>parameters<span class="op">$</span>ssM</code></pre></div>
<pre><code>## $A
##                X__1          X__2          X__3          X__4
##  [1,]  9.902461e-01 -0.0341477627 -0.0349554502  3.951889e-04
##  [2,] -2.951419e-02  0.7156788201 -0.2578433263  2.262486e-03
##  [3,] -3.219325e-02 -0.2622971746  0.7248789148  2.536054e-03
##  [4,]  3.809805e-04  0.0023301619  0.0025444660  9.758690e-01
##  [5,]  1.891457e-02 -0.0628656346  0.0231790640 -2.064149e-03
##  [6,]  9.415195e-05 -0.0002494190  0.0014345088  9.500797e-02
##  [7,]  7.096762e-03  0.0821178876  0.1171879265 -1.709680e-03
##  [8,] -1.414940e-03 -0.0461965950 -0.0423133686  1.529389e-04
##  [9,] -3.454219e-06  0.0002129306  0.0004138108  1.674112e-02
## [10,]  1.767425e-04  0.0022254152  0.0047213932 -6.036526e-05
##                X__5          X__6          X__7          X__8
##  [1,]  0.0178892463  9.363503e-05  0.0098910014  1.149628e-03
##  [2,] -0.0720023206 -3.363144e-04  0.0879888115 -4.100293e-02
##  [3,]  0.0202924338  1.355532e-03  0.1297861842 -2.815370e-02
##  [4,] -0.0020293604  9.501031e-02 -0.0018832749 -9.557869e-05
##  [5,]  0.5609291153 -7.967408e-04 -0.0951714775 -1.661523e-01
##  [6,] -0.0010872895  5.137078e-01  0.0001843103 -1.339665e-03
##  [7,] -0.0810401914  2.757872e-04  0.7507363194 -1.283953e-02
##  [8,] -0.1299511883 -1.047945e-03 -0.0209168479  7.321983e-01
##  [9,]  0.0007673638 -1.398990e-01 -0.0001389381  4.422561e-04
## [10,] -0.0105346779 -2.796444e-04 -0.0244580939 -1.606814e-03
##                X__9         X__10
##  [1,]  8.012291e-06  0.0015968603
##  [2,]  2.177648e-04  0.0115291172
##  [3,]  4.502494e-04  0.0221839186
##  [4,]  1.674068e-02 -0.0003745957
##  [5,]  5.713050e-04 -0.0453749877
##  [6,] -1.399026e-01 -0.0004026761
##  [7,] -1.033560e-04 -0.1199172425
##  [8,]  4.584948e-04 -0.1097349396
##  [9,]  7.510437e-01 -0.0007157662
## [10,] -6.136057e-04  0.6690089354
## 
## $Bu
##              X__1          X__2       X__3
##  [1,]  -1.2863481  -5.127213962 -1.2769706
##  [2,]   1.0377469 -23.639870670  1.0662717
##  [3,]  -1.8578441 -16.397734415 -1.9548543
##  [4,]   4.0921562   0.120281388 -3.9828719
##  [5,]   8.4911688  -3.849466905  8.3930268
##  [6,] -10.2013055  -0.008062870 10.2844215
##  [7,]   2.4016345   2.328494503  2.3726917
##  [8,]   1.9482616  -0.905524880  1.9478316
##  [9,]  -0.9551241   0.005801042  0.9583937
## [10,]   0.5214965   0.142189138  0.5228422
## 
## $Bd
##               X__1          X__2         X__3
##  [1,] -1.651993854 -0.3621928554 -6.095515453
##  [2,] -0.079582125  0.0327764689 -2.162736402
##  [3,] -1.054423437 -0.0709261439 -6.016315856
##  [4,]  0.019234965 -0.0156658215  0.106212445
##  [5,]  2.055863825  0.1061558756 11.748984753
##  [6,]  0.010249986  0.0008007878  0.058716662
##  [7,] -0.784684711 -0.3192514486  0.129024228
##  [8,] -0.902737950 -0.2629909018 -0.183950087
##  [9,] -0.004115286 -0.0130810568 -0.007598811
## [10,]  1.918207414  0.1395914579 -0.836037599
## 
## $C
##              X__1         X__2         X__3          X__4         X__5
## [1,] -0.003290563  0.001139590 -0.003637673  0.0041945242  0.014123995
## [2,] -0.006394231 -0.028360807 -0.022583134  0.0001867462 -0.003668759
## [3,] -0.003282924  0.001167913 -0.003732634 -0.0040117867  0.014016779
##               X__6        X__7         X__8          X__9       X__10
## [1,] -1.224743e-02 0.002897262  0.003087653 -2.151410e-03 0.001451047
## [2,] -1.947594e-06 0.005809756 -0.002515786  1.717696e-05 0.001060827
## [3,]  1.240724e-02 0.002857488  0.003094054  2.152449e-03 0.001451978</code></pre>
</div>
<div id="build-battery-object-and-set-value" class="section level2">
<h2 class="hasAnchor">
<a href="#build-battery-object-and-set-value" class="anchor"></a>build battery object and set value</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mpc3<span class="op">$</span>battery<span class="op">$</span><span class="kw">setvalue</span>(<span class="dt">ssmodel =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">A =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(<span class="fl">0.9800</span>), <span class="dt">Bu =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(<span class="fl">0.3333</span>)),
                      <span class="dt">continuous =</span> <span class="ot">FALSE</span>,
                      <span class="dt">timestep =</span> <span class="dv">1200</span>,
                      <span class="dt">x0 =</span> <span class="dv">0</span>,
                      <span class="dt">xbmax =</span> <span class="dv">20</span>,
                      <span class="dt">xbmin =</span> <span class="dv">0</span>,
                      <span class="dt">ubmax =</span> <span class="dv">20</span>,
                      <span class="dt">ubmin =</span> <span class="op">-</span><span class="dv">20</span>)
mpc3<span class="op">$</span>battery<span class="op">$</span>parameters</code></pre></div>
<pre><code>## $ssM
## $ssM$A
##      [,1]
## [1,] 0.98
## 
## $ssM$Bu
##        [,1]
## [1,] 0.3333
## 
## 
## $continuous
## [1] FALSE
## 
## $timestep
## [1] 1200
## 
## $x0
## [1] 0
## 
## $xbmax
## [1] 20
## 
## $xbmin
## [1] 0
## 
## $ubmax
## [1] 20
## 
## $ubmin
## [1] -20
## 
## $storage_type
## [1] "simple_battery"
## 
## $A_cst
## [1] NA
## 
## $B_cst
## [1] NA
## 
## $h_cst
## [1] NA</code></pre>
</div>
<div id="set-control-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#set-control-parameters" class="anchor"></a>set control parameters</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N &lt;-<span class="st"> </span><span class="dv">72</span> <span class="co">#prediction horizon</span>
Tsim &lt;-<span class="st"> </span><span class="dv">504</span> <span class="co">#simulation/control horizon</span>
nu &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(ssM<span class="op">$</span>Bu)
ny &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(ssM<span class="op">$</span>C)

ECR &lt;-<span class="st"> </span><span class="fl">1e6</span>
cost &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="fl">0.2</span>, <span class="dt">ncol =</span> nu, <span class="dt">nrow =</span> (N <span class="op">+</span><span class="st"> </span>Tsim))
ymax &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">26</span>, <span class="dt">nrow =</span> ny, <span class="dt">ncol =</span> (N <span class="op">+</span><span class="st"> </span>Tsim))
ymin &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">22</span>, <span class="dt">nrow =</span> ny, <span class="dt">ncol =</span> (N <span class="op">+</span><span class="st"> </span>Tsim))
yref &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">24</span>, <span class="dt">nrow =</span> ny, <span class="dt">ncol =</span> (N <span class="op">+</span><span class="st"> </span>Tsim))
umax &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">15</span>, <span class="dt">nrow =</span> ny, <span class="dt">ncol =</span> (N <span class="op">+</span><span class="st"> </span>Tsim))
umin &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">0</span> , <span class="dt">nrow =</span> ny, <span class="dt">ncol =</span> (N <span class="op">+</span><span class="st"> </span>Tsim))

timestep &lt;-<span class="st"> </span>ssM<span class="op">$</span>timestep <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>()
time &lt;-<span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(cost))<span class="op">*</span>timestep
<span class="cf">for</span> (i <span class="cf">in</span> time) {

  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">86400</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span><span class="op">*</span><span class="dv">3600</span> <span class="op">&amp;</span><span class="st"> </span>i <span class="op">%%</span><span class="st"> </span><span class="dv">86400</span> <span class="op">&lt;=</span><span class="dv">16</span><span class="op">*</span><span class="dv">3600</span>,
         cost[i<span class="op">/</span>timestep,] &lt;-<span class="st"> </span><span class="fl">0.2</span>,
         cost[i<span class="op">/</span>timestep,] &lt;-<span class="st"> </span><span class="fl">0.04</span>)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">86400</span> <span class="op">&lt;=</span><span class="st"> </span><span class="dv">8</span><span class="op">*</span><span class="dv">3600</span> <span class="op">|</span><span class="st"> </span>i <span class="op">%%</span><span class="st"> </span><span class="dv">86400</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">18</span><span class="op">*</span><span class="dv">3600</span>,
         ymax[,i<span class="op">/</span>timestep] &lt;-<span class="st"> </span><span class="dv">30</span>,
         ymax[,i<span class="op">/</span>timestep] &lt;-<span class="st"> </span><span class="dv">26</span>)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">86400</span> <span class="op">&lt;=</span><span class="st"> </span><span class="dv">8</span><span class="op">*</span><span class="dv">3600</span> <span class="op">|</span><span class="st"> </span>i <span class="op">%%</span><span class="st"> </span><span class="dv">86400</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">18</span><span class="op">*</span><span class="dv">3600</span>,
         ymin[,i<span class="op">/</span>timestep] &lt;-<span class="st"> </span><span class="dv">18</span>,
         ymin[,i<span class="op">/</span>timestep] &lt;-<span class="st"> </span><span class="dv">22</span>)
}</code></pre></div>
</div>
<div id="set-constraints-comfort-control" class="section level2">
<h2 class="hasAnchor">
<a href="#set-constraints-comfort-control" class="anchor"></a>set constraints-comfort control</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mpc3<span class="op">$</span><span class="kw">set_parameters</span>(<span class="dt">N =</span> N,
                    <span class="dt">Tsim =</span> Tsim,
                    <span class="dt">obj =</span> <span class="st">"cost"</span>, <span class="co">#comfort objective function</span>
                    <span class="dt">cost =</span> cost,
                    <span class="dt">ymin =</span> ymin,
                    <span class="dt">ymax =</span> ymax,
                    <span class="dt">yref =</span> yref,
                    <span class="dt">ECR =</span> ECR,
                    <span class="dt">umax =</span> umax,
                    <span class="dt">umin =</span> umin)
mpc3<span class="op">$</span><span class="kw">print_para</span>() ##use for print prediction horizon, control horizon, and ssM is continuous or not</code></pre></div>
<pre><code>## [1] "prediction horizon: 72 * 1200 s"
## [1] "simulation horizon: 504 * 1200 s"
## [1] "state-space continuous: discrete"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mpc3<span class="op">$</span><span class="kw">set_mpc_constraint</span>()</code></pre></div>
</div>
<div id="solve-mpc" class="section level2">
<h2 class="hasAnchor">
<a href="#solve-mpc" class="anchor"></a>solve MPC</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">solu &lt;-<span class="st"> </span>mpc3<span class="op">$</span><span class="kw">solve_mpc</span>(<span class="dt">control =</span> <span class="kw">ecos.control</span>(<span class="dt">maxit =</span> 1000L,
                                              <span class="dt">feastol =</span> <span class="fl">5e-5</span>,
                                              <span class="dt">reltol =</span> <span class="fl">1.5e-5</span>))</code></pre></div>
</div>
<div id="collect-results-and-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#collect-results-and-plot" class="anchor"></a>collect results and plot</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">time =</span> <span class="dv">1</span><span class="op">:</span>Tsim,
                   <span class="dt">room1 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(solu<span class="op">$</span>Y)[,<span class="dv">1</span>],
                   <span class="dt">room2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(solu<span class="op">$</span>Y)[,<span class="dv">2</span>],
                   <span class="dt">room3 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(solu<span class="op">$</span>Y)[,<span class="dv">3</span>])
ele  &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">time =</span> <span class="dv">1</span><span class="op">:</span>Tsim,
                   <span class="dt">room1 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(solu<span class="op">$</span>U)[,<span class="dv">1</span>],
                   <span class="dt">room2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(solu<span class="op">$</span>U)[,<span class="dv">2</span>],
                   <span class="dt">room3 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(solu<span class="op">$</span>U)[,<span class="dv">3</span>])
nete &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">time =</span> <span class="dv">1</span><span class="op">:</span>Tsim,
                   <span class="dt">nete =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">colSums</a></span>(solu<span class="op">$</span>U))

battery_V &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">time =</span> <span class="dv">1</span><span class="op">:</span>Tsim,
                        <span class="dt">batte =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(solu<span class="op">$</span>U)[,<span class="dv">4</span>])
battery_E &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">time =</span> <span class="dv">1</span><span class="op">:</span>Tsim,
                        <span class="dt">batte =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(solu<span class="op">$</span>Y)[,<span class="dv">4</span>])
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(reshape2)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)

hfactor &lt;-<span class="st"> </span><span class="dv">3600</span><span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(ssM<span class="op">$</span>timestep )

temp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">melt</span>(<span class="dt">id =</span> <span class="st">"time"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time<span class="op">/</span>hfactor , <span class="dt">y =</span> value ,<span class="dt">color =</span> variable)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"time/h"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"temperature/degC"</span>)</code></pre></div>
<p><img src="Demand-Response-Simple-Battery_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ele <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">melt</span>(<span class="dt">id =</span> <span class="st">"time"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time<span class="op">/</span>hfactor , <span class="dt">y =</span> value ,<span class="dt">color =</span> variable)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"time/h"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"electricity/kw"</span>)</code></pre></div>
<p><img src="Demand-Response-Simple-Battery_files/figure-html/unnamed-chunk-8-2.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nete <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time<span class="op">/</span>hfactor, <span class="dt">y =</span> nete)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">1</span> ,<span class="dt">colour =</span> <span class="st">"grey50"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"time/h"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"purchase electricity/kw"</span>)</code></pre></div>
<p><img src="Demand-Response-Simple-Battery_files/figure-html/unnamed-chunk-8-3.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">battery_V <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time<span class="op">/</span>hfactor, <span class="dt">y =</span> batte)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">1</span> ,<span class="dt">colour =</span> <span class="st">"grey50"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"time/h"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"battery/kw"</span>)</code></pre></div>
<p><img src="Demand-Response-Simple-Battery_files/figure-html/unnamed-chunk-8-4.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">battery_E <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time<span class="op">/</span>hfactor, <span class="dt">y =</span> batte)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">1</span> ,<span class="dt">colour =</span> <span class="st">"grey50"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"time/h"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"battery/kw"</span>)</code></pre></div>
<p><img src="Demand-Response-Simple-Battery_files/figure-html/unnamed-chunk-8-5.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#load-packages">load packages</a></li>
      <li><a href="#load-data">load data</a></li>
      <li><a href="#build-mpc-object-and-set-value">build MPC object and set value</a></li>
      <li><a href="#build-battery-object-and-set-value">build battery object and set value</a></li>
      <li><a href="#set-control-parameters">set control parameters</a></li>
      <li><a href="#set-constraints-comfort-control">set constraints-comfort control</a></li>
      <li><a href="#solve-mpc">solve MPC</a></li>
      <li><a href="#collect-results-and-plot">collect results and plot</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jiangyu Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
